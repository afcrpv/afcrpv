(function(e){e.fn.slideTo=function(t){return e(this).html(t),e("#members").slickGrid(),e(this).applyMinimumHeightFromChildren(),e(this).find(".pagination_frame").removeClass("frame_right").addClass("frame_center"),init_modal_dialogs(),init_tooltips(),e(this)},e.fn.slickGrid=function(t){function p(){return o}function d(){return f}function v(t){var n=[],r=b();return e(t).find("thead th").each(function(t,i){var s=e(i).widthFromClass();n.push({name:e(i).html(),field:e(i).attr("data-column-id"),id:e(i).attr("data-column-id"),width:s||r[t],resizable:s===null,sortable:e(i).hasClass("sortable")})}),n}function m(t,n){var r=[];return e(t).find("tbody tr").each(function(t,i){var s={};s.id=e(i).attr("data-row-id"),e(i).find("td").each(function(t,r){s[n[t].id]=e(r).html()}),r.push(s)}),r}function g(e,t){var n=t.grid.getColumns(),r=[];for(var i=0;i<n.length;i++)r.push(n[i].width);y(r)}function y(t){var n="["+(t||[]).join(",")+"]";e.cookie("membership_column_widths",n,{expires:1e4,path:"/"})}function b(){var t=e.cookie("membership_column_widths",{path:"/"})||"[]";return e.parseJSON(t)}function w(t,n){var r=n.sortAsc?"asc":"desc",i=n.grid.getColumnIndex(n.sortCol.id),s=T({order_by:i,order_dir:r,from_page:""});if(typeof window.history.pushState=="function"){var o=location.pathname+location.href.split(location.pathname)[1];window.history.pushState({path:o},"",s),e(".slick-grid").loading(),e(document).paginateTo(s)}else window.location=s}function E(){var e=S();return[parseInt(e.order_by||0),(e.order_dir||"asc").toLowerCase()]}function S(){var e=window.location.toString(),t={},n=e.split("?")[1];if(!n)return{};n=n.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");t[i[0]]=i[1]}return t}function x(){return e(".pagination").find("em").text()}function T(t){var n=window.location.toString().replace(/\?.*$/,""),r=S();t=t||{};var i=0;for(k in t)i++,t[k]!==null&&t[k]!==""?r[k]=t[k]:delete r[k];return i>0?n+"?"+e.param(r):i}function N(){e("#menu_container a.action").live("click",C)}function C(t){return t.preventDefault(),e(".slick-grid").loading(),e.ajax(e(this).attr("href"),{type:"PUT"}).complete(function(t){var n=e("<div></div>").appendTo(document.body).hide().html(t.responseText);L(n.find("table").get(0)),e(".slick-grid").stopLoading(),n.remove()}),!1}function L(e){if(!e)return!1;var t=v(e),n=m(e,t);for(var r=0;r<n.length;r++){var i=o.getItemIndex(n[r].id);o.updateItem(n[r]),f.invalidateRow(i),console.log(i,n[r])}f.render(),init_tooltips(),A()}function A(){a.find("span.row_actions span").each(function(t){var n=e(this).parent().find("> a"),r=n.clone().appendTo(h).addClass("menu_trigger").hide(),i=e(this),s="menu_"+Math.random();e(this).attr("id",s),e(this).appendTo(h).hide(),n.click(function(t){t.preventDefault();if(n.hasClass("open"))return;var s=n.offset(),o=n.outerHeight(),u=n.outerWidth(),a=e(i).outerHeight(!0),f=e(i).outerWidth(!0),l=e(window).height(!0)+e(window).scrollTop();s.top+o+a>l?(r.addClass("menu_on_top"),i.css({position:"absolute",top:s.top-a,left:s.left-f+u}).show(),r.css({position:"absolute",top:s.top-1,left:s.left}).show()):(r.addClass("menu_on_bottom"),i.css({position:"absolute",top:s.top+o,left:s.left-f+u}).show(),r.css({position:"absolute",top:s.top,left:s.left}).show()),n.addClass("open"),window.setTimeout(function(){e(document.body).one("click",function(){n.removeClass("open"),r.removeClass("menu_on_bottom"),r.removeClass("menu_on_top"),i.hide(),r.hide()})},100)})})}function O(){e("#filter_by").change(function(){var t=e(this).val(),n=x(),r=T({filter_by:t,page:1,from_page:n>1?n:""});if(typeof window.history.pushState=="function"){var i=location.pathname+location.href.split(location.pathname)[1];window.history.pushState({path:i},"",r),e(".slick-grid").loading(),e(document).paginateTo(r)}else window.location=r})}var n=function(e){this.id_field="id",this.data=e||[]};n.prototype.getItem=function(e){return this.data[e]},n.prototype.getItemIndex=function(e){if(!e)return null;for(var t=0;t<this.data.length;t++)if(this.data[t][this.id_field]==e)return t;return null},n.prototype.getLength=function(){return this.data.length},n.prototype.push=function(e){this.data.push(e)},n.prototype.updateItemByIndex=function(e,t){this.data[e]=t},n.prototype.updateItem=function(e){var t=this.getItemIndex(e.id);t!==null&&this.updateItemByIndex(t,e)};var r=this[0];if(!r)return!1;var i=v(r),s=m(r,i),o=new n(s),u={enableCellNavigation:!0,enableColumnReorder:!1,autoHeight:!0,forceFitColumns:!0,rowHeight:35,headerRowHeight:35};e(r).wrap("<div></div>");var a=e(r).parent();e(r).parent().addClass("slick-grid").css({width:e(r).width()});var f=new Slick.Grid(e(r).parent().get(0),o,i,u);e(".pagination_container").applyMinimumHeightFromChildren();var l=this;f.onSort.subscribe(function(){w.apply(l,arguments)}),f.onColumnsResized.subscribe(function(){g.apply(l,arguments)});var c=E();f.setSortColumn(i[c[0]||0].id,c[1]=="asc"),e(r).parent().show(),e("#menu_container").remove();var h=e('<div id="menu_container"></div>').appendTo(document.body).css({width:0,height:0});return init_tooltips(),A(),N(),O(),e(r)},e.fn.widthFromClass=function(){var e=this[0];if(!e)return null;var t=e.className.split(" ");for(var n=0;n<t.length;n++){var r=t[n];if(/^width_\d\d$/.exec(r))return parseInt(r.replace("width_",""))}return null},e.fn.loading=function(){e(this).find(".slick-header-column:last-child").css({"background-image":"url(/assets/refinery/icons/ajax-loader.gif)","background-position":"right center","background-repeat":"no-repeat"})},e.fn.stopLoading=function(){e(this).find(".slick-header-column:last-child").css({"background-image":""})},e.fn.getStyleObject=function(){var e=this.get(0),t,n={};if(window.getComputedStyle){var r=function(e,t){return t.toUpperCase()};t=window.getComputedStyle(e,null);for(var i=0;i<t.length;i++){var s=t[i],o=s.replace(/\-([a-z])/g,r),u=t.getPropertyValue(s);n[o]=u}return n}if(e.currentStyle){t=e.currentStyle;for(var s in t)n[s]=t[s];return n}return this.css()}})(jQuery);